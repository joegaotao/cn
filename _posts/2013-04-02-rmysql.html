--- 
layout: post
name: rmysql
title: "R\xE8\xBF\x9E\xE6\x8E\xA5MySQL\xE6\x95\xB0\xE6\x8D\xAE\xE5\xBA\x93\xE6\x96\xB9\xE6\xB3\x95\xE5\xA4\x87\xE5\xBF\x98"
date: 2013-04-02 22:57:00 +08:00
categories: 
- "\xE6\x95\xB0\xE6\x8D\xAE\xE5\xAF\xBC\xE5\x85\xA5"
permalink: /2013/04/rmysql.html
---
<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://dl.dropboxusercontent.com/u/6547489/blog/download.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-bjyu_wOnOx4/UVrw8kCG4RI/AAAAAAAABaM/_669IeRB5tY/s1600/download.jpg" /></a></div>R语言连接数据库可以利用数据库的存贮能力和R的计算能力，起到取长补短的效果。之前我们也说过了<a href="http://xccds1977.blogspot.com/2012/10/rsql.html">如何在R中使用SQL</a>，很多教材上也提到了连接MySQL的方法，但是在安装上还需要注意一些细节问题。以下的解决方法也是在网上放狗加撞墙实验得出的结论。<br /><br /><b></b><br /><a name='more'></a><b>一、win平台</b><br />如果是在windows平台上安装，推荐采用ODBC连接方式。除了需要安装R和MySQL之外，还要安装RODBC扩展包，以及MySQL的ODBC驱动。下面是具体步骤：<br /><br />1、R下载RODBC包，安装好。<br />2、在http://dev.mysql.com/downloads/connector/odbc<br />下载mySQL ODBC，安装好。<br />3、windows：控制面板-&gt;管理工具-&gt;数据源（ODBC）-&gt;双击-&gt;添加-&gt;选中mysql ODBC driver一项<br />填写：data source name 一项填入你要使用的名字，自己随便命名，例如：mysql_data;<br />description一项随意填写，例如mydata<br />TCP/IP Server 填写服务器IP，本地数据库一般为：127.0.0.1<br />user 填写你的mysql用户名<br />password 填写你的mysql密码<br />然后数据库里会出现你的mysql里的所有数据库，选择一个数据库。<br />确定。<br />4、打开R调用数据库：<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/RODBC">RODBC</a><span style="color: #009900;">)</span><br />channel &lt;- odbcConnect<span style="color: #009900;">(</span><span style="color: blue;">"mysql_data"</span><span style="color: #339933;">,</span> uid=<span style="color: blue;">"abc"</span><span style="color: #339933;">,</span> pwd=<span style="color: blue;">"abc"</span><span style="color: #009900;">)</span><br />sqlTables<span style="color: #009900;">(</span>channel<span style="color: #009900;">)</span>  <span style="color: #666666; font-style: italic;">#查看数据中的表</span><br />data&lt;-sqlFetch<span style="color: #009900;">(</span>channel<span style="color: #339933;">,</span><span style="color: blue;">"abc"</span><span style="color: #009900;">)</span>  <span style="color: #666666; font-style: italic;"># 查看表的内容，存到数据框里</span><br /></pre></div></div><br /><b>二、linux平台</b><br />在linux平台下使用ODBC连接安装比较麻烦，推荐采用JDBC连接方式。具体安装方式如下：<br /><br />在软件源中增加R官方源，方法具体见官网说明；之后在term中运行发下命令，安装需要的软件：<br />sudo apt-get update<br />sudo apt-get install r-base<br />sudo apt-get install r-dev<br />sudo apt-get install r-cran-rmysql<br />sudo apt-get install r-cran-dbi<br />sudo apt-get install mysql-server my-client<br />sudo apt-get install libmysqlclient-dev<br /><br />在R中加载RMySQL两个包，并使用dbConnect函数设置好用户名和密码<br /><pre class="r geshifilter-R"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/RMySQL">RMySQL</a><span style="color: #009900;">)</span><br />con &lt;- dbConnect<span style="color: #009900;">(</span>MySQL<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />                 user=<span style="color: blue;">'abc'</span><span style="color: #339933;">,</span> ＃ 用户名<br />                 password=<span style="color: blue;">'abc'</span><span style="color: #339933;">,</span> ＃ 密码<br />                 dbname=<span style="color: blue;">'abc'</span><span style="color: #339933;">,</span> ＃ 要使用的数据库名称<br />                 host=<span style="color: blue;">"localhost"</span><span style="color: #009900;">)</span> ＃ 主机地址<br />dbListTables<span style="color: #009900;">(</span>con<span style="color: #009900;">)</span> ＃ 列出所有数据库中的表<br />＃ 运行sql语句并返回数据到R&nbsp;</pre><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a> &lt;- dbGetQuery<span style="color: #009900;">(</span>con<span style="color: #339933;">,</span> <span style="color: blue;">"select * from abc"</span><span style="color: #009900;">)</span><br />SQL查询可以通过dbSendQuery或dbGetQuery传给数据库管理系统。dbGetQuery传送查询语句，把结果以数据框形式返回。dbSendQuery传送查询，返回的结果是继承"DBIResult"的一个子类的对象。"DBIResult"类可用于取得结果，而且还可以通过调用dbClearResult清除结果。函数fetch用于获得查询结果的部分或全部行，并以列表返回。函数dbHasCompleted确定是否所有行已经获得了，而dbGetRowCount返回结果中行的数目。如果只是简单的读整个表，也可以用dbReadTable函数。<br /><br /><br />在设置连接时会在R语言环境中明文标示了数据库用户和密码，为了安全起见，可以作如下设置：<br />在本机目录中定义一个配置文档（ ~/.my/cnf），例如定义两个使用MySQL的用户组：<br />[local]<br />user = root<br />password = ultra_secret<br />host = localhost<br /><br />[toto]<br />user = capitaine_flam<br />password = galaxy<br />host = milky.way.net<br /><br />然后在R中使用用户组：<br /><br /><pre class="r geshifilter-R"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/RMySQL">RMySQL</a><span style="color: #009900;">)</span><br />con &lt;- dbConnect<span style="color: #009900;">(</span>MySQL<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a>=<span style="color: blue;">'toto'</span><span style="color: #339933;">,</span> dbname=<span style="color: blue;">"user_profile"</span><span style="color: #009900;">)</span><br />m &lt;- dbGetQuery<span style="color: #009900;">(</span>con<span style="color: #339933;">,</span> <span style="color: blue;">"SELECT DISTINCT user_id FROM demographics WHERE gender='0'"</span><span style="color: #009900;">)</span><br />dbDisconnect<span style="color: #009900;">(</span>con<span style="color: #009900;">)</span></pre><pre class="r geshifilter-R"><div style="font-family: 'WenQuanYi Micro Hei'; white-space: normal;"><br />另外R连接mysql会出现中文乱码变问号情况，查到COS上一个贴子，解决方案如下：</div><br /><div style="font-family: 'WenQuanYi Micro Hei'; white-space: normal;"><br />在MySQL的配置文件/etc/mysql/my.cnf中[client]标签下加default-character-set=utf8</div><br /></pre><br /><br /><br /><br /><blockquote class="tr_bq"><blockquote class="tr_bq"><!-----><!-----><!-----><!-----><!---sqlfetch--><!-----><!-----><!-----><!-----><!-----><!---sqlfetch--><!-----><!-----><!-----></blockquote><!-----><!-----></blockquote>
